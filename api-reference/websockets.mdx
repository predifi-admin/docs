---
title: "WebSocket API"
description: "Real-time market data, orderbook, trades, and portfolio updates via WebSocket"
---

## Overview

Real-time data streams for:
- **Market data** - Price and volume updates
- **Orderbook** - Bid/ask depth changes
- **Trades** - Execution stream
- **User intents** - Trading status (requires auth)
- **Portfolio** - Balance/position changes (requires auth)

<Info>
  WebSocket provides sub-second updates. Prefer over polling REST endpoints.
</Info>

---

## Connection

Connect to:
```
wss://api.predifi.com/ws
```

### Authentication

**Option 1: URL parameter**
```javascript
const ws = new WebSocket('wss://api.predifi.com/ws?apiKey=YOUR_API_KEY');
```

**Option 2: Post-connect message**
```javascript
const ws = new WebSocket('wss://api.predifi.com/ws');

ws.onopen = () => {
  ws.send(JSON.stringify({
    type: 'auth',
    apiKey: 'YOUR_API_KEY'
  }));
};
```

<Warning>
  Authentication required for `user_intent` and `portfolio` channels.
</Warning>

---

## Subscription

### Subscribe
```json
{
  "type": "subscribe",
  "channel": "market",
  "market": "BTC-15M-20250111-1430"
}
```

### Unsubscribe
```json
{
  "type": "unsubscribe",
  "channel": "market",
  "market": "BTC-15M-20250111-1430"
}
```

### Confirmation
```json
{
  "type": "subscribed",
  "channel": "market",
  "market": "BTC-15M-20250111-1430"
}
```

---

## Channels

### Market Data

Price and volume updates every 1-5 seconds.

**Subscribe:**
```json
{
  "type": "subscribe",
  "channel": "market",
  "market": "BTC-15M-20250111-1430"
}
```

**Update message:**
```json
{
  "type": "market_update",
  "data": {
    "marketId": "BTC-15M-20250111-1430",
    "yesPrice": 0.6543,
    "noPrice": 0.3457,
    "volume24h": 125678.90,
    "volume1h": 12456.78,
    "priceChange24h": 0.0234,
    "priceChange1h": 0.0045,
    "trades24h": 1234,
    "traders24h": 567,
    "liquidity": 89012.34,
    "timestamp": 1638360000000
  }
}
```

### Orderbook

Real-time bid/ask depth changes.

**Subscribe:**
```json
{
  "type": "subscribe",
  "channel": "orderbook",
  "market": "BTC-15M-20250111-1430",
  "outcome": 0  // Optional: 0=YES, 1=NO, omit for both
}
```

**Update message:**
```json
{
  "type": "orderbook_update",
  "data": {
    "marketId": "BTC-15M-20250111-1430",
    "outcomeId": 0,
    "bids": [
      {"price": 0.6600, "size": 1500.50, "total": 990.33},
      {"price": 0.6550, "size": 2340.75, "total": 1533.19}
    ],
    "asks": [
      {"price": 0.6650, "size": 1200.00, "total": 798.00},
      {"price": 0.6700, "size": 3450.25, "total": 2311.67}
    ],
    "spread": 0.0050,
    "midPrice": 0.6625,
    "timestamp": 1638360000000
  }
}
```

### Trades

New trade executions. Subscribe to specific market or all with `*`.

**Subscribe:**
```json
{
  "type": "subscribe",
  "channel": "trades",
  "market": "*"  // Or specific market ID
}
```

**Trade message:**
```json
{
  "type": "trade",
  "data": {
    "tradeId": "0x123abc",
    "marketId": "BTC-15M-20250111-1430",
    "outcomeId": 0,
    "side": "buy",
    "price": 0.6550,
    "size": 1000.00,
    "value": 655.00,
    "venue": "polymarket",
    "timestamp": 1638360000000
  }
}
```

### User Intent (Auth Required)

Track your trading intent status.

**Subscribe:**
```json
{
  "type": "subscribe",
  "channel": "user_intent"
}
```

**Intent update:**
```json
{
  "type": "intent_update",
  "data": {
    "intentId": "0x456def",
    "status": "executing",
    "marketId": "BTC-15M-20250111-1430",
    "outcomeId": 0,
    "targetSize": 1000,
    "filledSize": 450,
    "fills": [
      {
        "venue": "polymarket",
        "size": 300,
        "avgPrice": 0.6543,
        "txHash": "0xabc..."
      },
      {
        "venue": "predifi_clob",
        "size": 150,
        "avgPrice": 0.6551,
        "txHash": "0xdef..."
      }
    ],
    "timestamp": 1638360000000
  }
}
```

### Portfolio (Auth Required)

Balance and position changes.

**Subscribe:**
```json
{
  "type": "subscribe",
  "channel": "portfolio"
}
```

**Update message:**
```json
{
  "type": "portfolio_update",
  "data": {
    "balanceChange": {
      "chain": "arbitrum",
      "amount": -100.00,
      "newBalance": 4900.00
    },
    "positionChange": {
      "marketId": "BTC-15M-20250111-1430",
      "outcomeId": 0,
      "sharesChange": 150.0,
      "totalShares": 1500.0,
      "pnl": 45.67
    },
    "timestamp": 1638360000000
  }
}
```

---

## Message Types

| Type | Direction | Description |
|------|-----------|-------------|
| `subscribe` | Client → Server | Subscribe to channel |
| `unsubscribe` | Client → Server | Unsubscribe from channel |
| `subscribed` | Server → Client | Subscription confirmed |
| `market_update` | Server → Client | Market data update |
| `orderbook_update` | Server → Client | Orderbook change |
| `trade` | Server → Client | New trade execution |
| `intent_update` | Server → Client | Intent status change |
| `portfolio_update` | Server → Client | Balance/position change |
| `auth` | Client → Server | Authenticate connection |
| `authenticated` | Server → Client | Auth successful |
| `ping` | Client ↔ Server | Keep-alive |
| `pong` | Client ↔ Server | Keep-alive response |
| `error` | Server → Client | Error message |

---

## Error Handling

| Error Code | Description |
|------------|-------------|
| `AUTH_REQUIRED` | Channel requires authentication |
| `INVALID_CHANNEL` | Unknown channel name |
| `INVALID_PARAMS` | Missing/invalid parameters |
| `RATE_LIMIT` | Too many subscriptions/messages |
| `MARKET_NOT_FOUND` | Market doesn't exist |
| `INSUFFICIENT_PERMISSIONS` | API key lacks permission |

**Error message format:**
```json
{
  "type": "error",
  "code": "AUTH_REQUIRED",
  "message": "This channel requires authentication",
  "channel": "user_intent"
}
```

---

## Reconnection Logic

<CodeGroup>

```typescript TypeScript
class PredifiWebSocket {
  private ws: WebSocket | null = null;
  private subscriptions: Set<string> = new Set();
  private reconnectDelay = 1000;
  
  connect(apiKey: string) {
    this.ws = new WebSocket(`wss://api.predifi.com/ws?apiKey=${apiKey}`);
    
    this.ws.onopen = () => {
      console.log('Connected');
      this.reconnectDelay = 1000;
      // Resubscribe to all channels
      this.subscriptions.forEach(sub => this.ws!.send(sub));
    };
    
    this.ws.onclose = () => {
      console.log(`Reconnecting in ${this.reconnectDelay}ms...`);
      setTimeout(() => {
        this.reconnectDelay = Math.min(this.reconnectDelay * 2, 30000);
        this.connect(apiKey);
      }, this.reconnectDelay);
    };
    
    this.ws.onerror = (error) => console.error('WebSocket error:', error);
  }
  
  subscribe(channel: string, market?: string) {
    const msg = JSON.stringify({ type: 'subscribe', channel, market });
    this.subscriptions.add(msg);
    this.ws?.send(msg);
  }
  
  onMessage(callback: (data: any) => void) {
    if (this.ws) {
      this.ws.onmessage = (event) => callback(JSON.parse(event.data));
    }
  }
}

// Usage
const predifi = new PredifiWebSocket();
predifi.connect(process.env.API_KEY!);
predifi.subscribe('market', 'BTC-15M-20250111-1430');
predifi.onMessage((msg) => console.log(msg));
```

```python Python
import websocket
import json
import time

class PredifiWebSocket:
    def __init__(self, api_key):
        self.api_key = api_key
        self.subscriptions = []
        self.reconnect_delay = 1
        
    def connect(self):
        self.ws = websocket.WebSocketApp(
            f"wss://api.predifi.com/ws?apiKey={self.api_key}",
            on_open=self.on_open,
            on_message=self.on_message,
            on_close=self.on_close,
            on_error=self.on_error
        )
        self.ws.run_forever()
        
    def on_open(self, ws):
        print("Connected")
        self.reconnect_delay = 1
        for sub in self.subscriptions:
            ws.send(json.dumps(sub))
            
    def on_close(self, ws, close_status, close_msg):
        print(f"Reconnecting in {self.reconnect_delay}s...")
        time.sleep(self.reconnect_delay)
        self.reconnect_delay = min(self.reconnect_delay * 2, 30)
        self.connect()
        
    def on_error(self, ws, error):
        print(f"Error: {error}")
        
    def on_message(self, ws, message):
        data = json.loads(message)
        print(data)
        
    def subscribe(self, channel, market=None):
        msg = {'type': 'subscribe', 'channel': channel}
        if market:
            msg['market'] = market
        self.subscriptions.append(msg)
        if self.ws:
            self.ws.send(json.dumps(msg))

# Usage
client = PredifiWebSocket(os.getenv('API_KEY'))
client.subscribe('market', 'BTC-15M-20250111-1430')
client.connect()
```

</CodeGroup>

---

## Rate Limits

| Limit | Value |
|-------|-------|
| **Concurrent connections** | 5 per API key |
| **Subscriptions per connection** | 50 |
| **Messages per second** | 100 |

<Tip>
  One connection can handle multiple subscriptions. Reuse connections.
</Tip>

---

## Best Practices

<AccordionGroup>
  <Accordion title="Handle Reconnections" icon="rotate">
    Implement exponential backoff and resubscribe on reconnect.
  </Accordion>

  <Accordion title="Use Wildcard Subscriptions" icon="asterisk">
    Subscribe to `trades:*` instead of individual markets for global trade feed.
  </Accordion>

  <Accordion title="Heartbeat/Ping" icon="heart-pulse">
    Send ping every 30 seconds to keep connection alive.
  </Accordion>

  <Accordion title="Buffer Messages" icon="database">
    Buffer updates during processing to avoid blocking the WebSocket thread.
  </Accordion>

  <Accordion title="Graceful Shutdown" icon="power-off">
    Unsubscribe and close WebSocket properly when done.
  </Accordion>
</AccordionGroup>

---

## Next Steps

<CardGroup cols={2}>
  <Card title="Trading API" icon="cart-shopping" href="/api-reference/trading">
    Execute trades based on real-time data
  </Card>
  <Card title="Markets API" icon="chart-line" href="/api-reference/markets">
    Browse available markets
  </Card>
  <Card title="Portfolio API" icon="wallet" href="/api-reference/portfolio">
    Track your positions
  </Card>
  <Card title="Orderbook API" icon="book" href="/api-reference/orderbook">
    View orderbook depth
  </Card>
</CardGroup>

<!-- validation-check -->
